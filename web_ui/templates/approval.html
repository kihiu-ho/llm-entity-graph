<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Entity Approval Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/approval.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="approval-header">
            <div class="header-content">
                <h1><i class="fas fa-clipboard-check"></i> Entity Approval Dashboard</h1>
                <div class="approval-status">
                    <span id="approval-progress" class="progress-indicator">0%</span>
                    <span id="session-status" class="session-status">No Session</span>
                </div>
            </div>
            <nav class="approval-nav">
                <button id="back-to-main" class="nav-btn">
                    <i class="fas fa-arrow-left"></i> Back to Main
                </button>
                <button id="new-session-btn" class="nav-btn primary">
                    <i class="fas fa-plus"></i> New Session
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="approval-content">
            
            <!-- Session Creation Panel -->
            <div id="session-panel" class="panel hidden">
                <div class="panel-header">
                    <h3><i class="fas fa-file-alt"></i> Create Approval Session</h3>
                    <button id="close-session-panel" class="close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="panel-body">
                    <form id="session-form">
                        <div class="form-group">
                            <label for="document-title">Document Title:</label>
                            <input type="text" id="document-title" required placeholder="Enter document title">
                        </div>
                        <div class="form-group">
                            <label for="document-source">Document Source:</label>
                            <input type="text" id="document-source" required placeholder="Enter document source identifier">
                        </div>
                        <div class="form-group">
                            <label for="reviewer-id">Reviewer ID:</label>
                            <input type="text" id="reviewer-id" placeholder="default_reviewer">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn primary">Create Session</button>
                            <button type="button" id="cancel-session" class="btn secondary">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Statistics Dashboard -->
            <div id="stats-dashboard" class="dashboard-section">
                <h3><i class="fas fa-chart-pie"></i> Approval Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-list"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="total-entities">0</div>
                            <div class="stat-label">Total Entities</div>
                        </div>
                    </div>
                    <div class="stat-card approved">
                        <div class="stat-icon"><i class="fas fa-check"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="approved-count">0</div>
                            <div class="stat-label">Approved</div>
                        </div>
                    </div>
                    <div class="stat-card rejected">
                        <div class="stat-icon"><i class="fas fa-times"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="rejected-count">0</div>
                            <div class="stat-label">Rejected</div>
                        </div>
                    </div>
                    <div class="stat-card pending">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-content">
                            <div class="stat-value" id="pending-count">0</div>
                            <div class="stat-label">Pending</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div id="control-panel" class="dashboard-section">
                <div class="controls-header">
                    <h3><i class="fas fa-sliders-h"></i> Review Controls</h3>
                    <div class="control-actions">
                        <button id="bulk-approve-btn" class="btn success" disabled>
                            <i class="fas fa-check-double"></i> Bulk Approve
                        </button>
                        <button id="approve-all-btn" class="btn success">
                            <i class="fas fa-check-circle"></i> Approve All
                        </button>
                        <button id="clean-pending-btn" class="btn warning">
                            <i class="fas fa-trash-alt"></i> Clean Pending
                        </button>
                        <button id="open-ingestion-panel-btn" class="btn primary">
                            <i class="fas fa-database"></i> Neo4j Ingestion
                        </button>
                        <button id="refresh-data-btn" class="btn secondary">
                            <i class="fas fa-sync"></i> Refresh Data
                        </button>
                    </div>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="entity-type-filter">Entity Type:</label>
                        <select id="entity-type-filter" multiple>
                            <option value="Person">Person</option>
                            <option value="Company">Company</option>
                            <option value="Location">Location</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="status-filter">Status:</label>
                        <select id="status-filter">
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="search-input">Search:</label>
                        <input type="text" id="search-input" placeholder="Search entities...">
                    </div>
                </div>
            </div>

            <!-- Entity Review Table -->
            <div id="entity-review-section" class="dashboard-section">
                <div class="section-header">
                    <h3><i class="fas fa-table"></i> Entity Review</h3>
                    <div class="section-controls">
                        <span id="entity-count">0 entities</span>
                        <button id="select-all-btn" class="btn small">Select All</button>
                        <button id="clear-selection-btn" class="btn small">Clear</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="entities-table" class="review-table">
                        <thead>
                            <tr>
                                <th class="select-col">
                                    <input type="checkbox" id="select-all-checkbox">
                                </th>
                                <th class="type-col">Type</th>
                                <th class="name-col">Name</th>
                                <th class="properties-col">Properties</th>
                                <th class="status-col">Status</th>
                                <th class="actions-col">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="entities-tbody">
                            <!-- Entity rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <div id="no-entities" class="empty-state hidden">
                    <i class="fas fa-inbox"></i>
                    <h4>No Entities Found</h4>
                    <p>No entities match your current filters.</p>
                </div>
            </div>

            <!-- Relationship Review Section -->
            <div id="relationship-review-section" class="dashboard-section">
                <div class="section-header">
                    <h3><i class="fas fa-project-diagram"></i> Relationship Review</h3>
                    <div class="section-controls">
                        <span id="relationship-count">0 relationships</span>
                        <button id="toggle-relationships-btn" class="btn small">
                            <i class="fas fa-eye"></i> Show Relationships
                        </button>
                    </div>
                </div>
                
                <div id="relationships-container" class="hidden">
                    <div class="table-container">
                        <table id="relationships-table" class="review-table">
                            <thead>
                                <tr>
                                    <th class="select-col">
                                        <input type="checkbox" id="select-all-relationships">
                                    </th>
                                    <th class="type-col">Type</th>
                                    <th class="source-col">Source</th>
                                    <th class="target-col">Target</th>
                                    <th class="properties-col">Properties</th>
                                    <th class="status-col">Status</th>
                                    <th class="actions-col">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="relationships-tbody">
                                <!-- Relationship rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </main>

        <!-- Entity Detail Modal -->
        <div id="entity-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-user"></i> Entity Details</h3>
                    <button id="close-entity-modal" class="close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="entity-details">
                        <!-- Entity details will be populated by JavaScript -->
                    </div>
                    <div class="property-editor">
                        <h4>Edit Properties</h4>
                        <div class="property-controls">
                            <button id="add-property-btn" class="btn small success">
                                <i class="fas fa-plus"></i> Add Property
                            </button>
                            <button id="reset-properties-btn" class="btn small secondary">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                        <div id="property-fields">
                            <!-- Property fields will be populated by JavaScript -->
                        </div>
                        <div id="property-template" class="property-row hidden">
                            <div class="property-field">
                                <label class="property-label">
                                    <input type="text" class="property-key" placeholder="Property name">
                                </label>
                                <div class="property-value-container">
                                    <input type="text" class="property-value" placeholder="Property value">
                                    <select class="property-type">
                                        <option value="text">Text</option>
                                        <option value="number">Number</option>
                                        <option value="boolean">Boolean</option>
                                        <option value="date">Date</option>
                                    </select>
                                    <button class="btn small danger remove-property">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="review-notes">
                        <label for="modal-review-notes">Review Notes:</label>
                        <textarea id="modal-review-notes" placeholder="Add notes about your decision..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button id="modal-approve-btn" class="btn success">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button id="modal-approve-with-changes-btn" class="btn warning">
                            <i class="fas fa-edit"></i> Approve with Changes
                        </button>
                        <button id="modal-reject-btn" class="btn danger">
                            <i class="fas fa-times"></i> Reject
                        </button>
                        <button id="modal-cancel-btn" class="btn secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Relationship Detail Modal -->
        <div id="relationship-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-project-diagram"></i> Relationship Details</h3>
                    <button id="close-relationship-modal" class="close-btn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="relationship-details">
                        <!-- Relationship details will be populated by JavaScript -->
                    </div>
                    <div class="relationship-editor">
                        <h4>Edit Relationship</h4>
                        <div class="form-group">
                            <label for="relationship-type-edit">Relationship Type:</label>
                            <input type="text" id="relationship-type-edit" placeholder="e.g., WORKS_FOR, OWNS">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="source-entity-edit">Source Entity:</label>
                                <input type="text" id="source-entity-edit" readonly>
                            </div>
                            <div class="form-group">
                                <label for="target-entity-edit">Target Entity:</label>
                                <input type="text" id="target-entity-edit" readonly>
                            </div>
                        </div>
                        <div class="property-controls">
                            <button id="add-relationship-property-btn" class="btn small success">
                                <i class="fas fa-plus"></i> Add Property
                            </button>
                            <button id="reset-relationship-properties-btn" class="btn small secondary">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                        </div>
                        <div id="relationship-property-fields">
                            <!-- Relationship property fields will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="review-notes">
                        <label for="relationship-modal-review-notes">Review Notes:</label>
                        <textarea id="relationship-modal-review-notes" placeholder="Add notes about your decision..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button id="relationship-modal-approve-btn" class="btn success">
                            <i class="fas fa-check"></i> Approve
                        </button>
                        <button id="relationship-modal-approve-with-changes-btn" class="btn warning">
                            <i class="fas fa-edit"></i> Approve with Changes
                        </button>
                        <button id="relationship-modal-reject-btn" class="btn danger">
                            <i class="fas fa-times"></i> Reject
                        </button>
                        <button id="relationship-modal-cancel-btn" class="btn secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ingestion Control Panel -->
        <div id="ingestion-panel" class="panel hidden">
            <div class="panel-header">
                <h3><i class="fas fa-database"></i> Neo4j Ingestion</h3>
                <button id="close-ingestion-panel" class="close-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="panel-body">
                <div class="ingestion-info">
                    <p>Move approved entities and relationships from the pre-approval database to Neo4j.</p>
                    <div class="ingestion-stats">
                        <div class="stat-item">
                            <span class="stat-label">Approved Entities:</span>
                            <span id="approved-entities-count" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Approved Relationships:</span>
                            <span id="approved-relationships-count" class="stat-value">0</span>
                        </div>
                    </div>
                </div>
                <div class="ingestion-controls">
                    <button id="start-ingestion-btn" class="btn primary">
                        <i class="fas fa-play"></i> Start Ingestion
                    </button>
                    <button id="ingestion-status-btn" class="btn secondary">
                        <i class="fas fa-info-circle"></i> Check Status
                    </button>
                </div>
                <div id="ingestion-results" class="ingestion-results hidden">
                    <!-- Ingestion results will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Notification System -->
        <div id="notifications" class="notifications">
            <!-- Notifications will be added by JavaScript -->
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Processing...</p>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/approval.js') }}"></script>
</body>
</html>